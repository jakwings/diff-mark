<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
    <meta http-equiv="Cache-Control" content="no-cache">
    <title>diff-mark</title>
    <script src="diffmark.js"></script>
    <style>
      table { background: white; }
      #diff-result, #mark-result { white-space: pre; }
      .sp { background: yellow; }
    </style>
  </head>

  <body>
    <a href="https://github.com/jakwings/diff-mark"><img style="position: absolute; top: 0; right: 0; border: 0; z-index: -1;" src="https://camo.githubusercontent.com/a6677b08c955af8400f44c6298f40e7d19cc5b2d/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f677261795f3664366436642e706e67" alt="Fork me on GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_right_gray_6d6d6d.png"></a>
    <table border="1">
      <thead>
        <tr><th>method</th><th>arg#1</th><th>arg#2</th><th>result</th></tr>
      </thead>
      <tbody>
        <tr id="diff">
          <td>diff</td>
          <td><input type="text" placeholder="before" autofocus="true"></td>
          <td><input type="text" placeholder="after"></td>
          <td id="diff-result"></td>
        </tr>
        <tr id="mark">
          <td>mark</td>
          <td><input type="text" placeholder="text"></td>
          <td><input type="text" placeholder="diff"></td>
          <td id="mark-result"></td>
        </tr>
      </tbody>
    </table>
    <script>
      var elmDiff = document.getElementById('diff');
      var elmDiffOutput = document.getElementById('diff-result');
      var elmDiffArgs = [].slice.call(elmDiff.getElementsByTagName('input'));
      var elmMark = document.getElementById('mark');
      var elmMarkOutput = document.getElementById('mark-result');
      var elmMarkArgs = [].slice.call(elmMark.getElementsByTagName('input'));
      elmDiffArgs.forEach(function (d) {
        d.addEventListener('input', function (evt) {
          elmDiffOutput.textContent = diffmark.diff(elmDiffArgs[0].value, elmDiffArgs[1].value);
          elmMarkArgs[0].value = elmDiffArgs[0].value;
          elmMarkArgs[1].value = elmDiffOutput.textContent;
          elmMarkOutput.textContent = diffmark.mark(elmMarkArgs[0].value, elmMarkArgs[1].value);
          elmDiffOutput.innerHTML = elmDiffOutput.innerHTML.replace(/ /g, '<span class="sp">&sdot;</span>');
          elmMarkOutput.innerHTML = elmMarkOutput.innerHTML.replace(/ /g, '<span class="sp">&sdot;</span>');
        }, false);
      });
      elmMarkArgs.forEach(function (d) {
        d.addEventListener('input', function (evt) {
          elmMarkOutput.textContent = diffmark.mark(elmMarkArgs[0].value, elmMarkArgs[1].value);
          elmDiffArgs[0].value = elmMarkArgs[0].value;
          elmDiffArgs[1].value = elmMarkOutput.textContent;
          elmDiffOutput.textContent = diffmark.diff(elmDiffArgs[0].value, elmDiffArgs[1].value);
          elmDiffOutput.innerHTML = elmDiffOutput.innerHTML.replace(/ /g, '<span class="sp">&sdot;</span>');
          elmMarkOutput.innerHTML = elmMarkOutput.innerHTML.replace(/ /g, '<span class="sp">&sdot;</span>');
        }, false);
      });
    </script>

    <pre id="dump"></pre>
    <script>
      var xhr = new XMLHttpRequest();
      xhr.open('GET', 'RantionaryDump.txt?_=' + (new Date()).getTime());
      xhr.onreadystatechange = function () {
        if (this.readyState === 4) {
          var dump = [];
          this.responseText.split('\n').forEach(function (line) {
            var words = line.split('/');
            if (words.length < 2) { return; }
            var diffs = words.map(function (item, i, arr) {
              if (i > 0) {
                return diffmark.diff(arr[0], item);
              }
              return item;
            });
            words = diffs.map(function (item, i, arr) {
              if (i > 0) {
                return diffmark.mark(arr[0], item);
              }
              return item;
            });
            dump.push('>> ' + diffs.join('/') + '\n > ' + words.join('/'));
          });
          document.getElementById('dump').textContent = dump.join('\n\n');
        }
      };
      xhr.send();
    </script>
  </body>

</html>
