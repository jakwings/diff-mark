<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
    <meta http-equiv="Cache-Control" content="no-cache">
    <title>diff-mark</title>
    <script src="diffmark.js"></script>
    <style>
      table { background: white; }
      input { width: 120px; padding: 0; margin: 0; font-size: inherit; }
      #diff-result, #mark-result { white-space: pre; }
      .error { background: #fbb; }
      .sp { background: yellow; }
    </style>
  </head>

  <body>
    <h3><a href="https://github.com/jakwings/diff-mark">Fork me on GitHub</a></h3>
    <table border="1">
      <thead>
        <tr><th>method</th><th>arg#1</th><th>arg#2</th><th>result</th></tr>
      </thead>
      <tbody>
        <tr id="diff">
          <td>diff</td>
          <td><input type="text" placeholder="before" autofocus="true"></td>
          <td><input type="text" placeholder="after"></td>
          <td id="diff-result"></td>
        </tr>
        <tr id="mark">
          <td>mark</td>
          <td><input type="text" placeholder="text"></td>
          <td><input type="text" placeholder="diff"></td>
          <td id="mark-result"></td>
        </tr>
      </tbody>
    </table>
    <script>
      var elmDiff = document.getElementById('diff');
      var elmDiffOutput = document.getElementById('diff-result');
      var elmDiffArgs = [].slice.call(elmDiff.getElementsByTagName('input'));
      var elmMark = document.getElementById('mark');
      var elmMarkOutput = document.getElementById('mark-result');
      var elmMarkArgs = [].slice.call(elmMark.getElementsByTagName('input'));
      elmDiffArgs.forEach(function (d) {
        d.addEventListener('input', function (evt) {
          elmDiffOutput.textContent = diffmark.diff(elmDiffArgs[0].value, elmDiffArgs[1].value);
          elmMarkArgs[0].value = elmDiffArgs[0].value;
          elmMarkArgs[1].value = elmDiffOutput.textContent;
          var ret = diffmark.mark(elmMarkArgs[0].value, elmMarkArgs[1].value);
          elmMarkOutput.className = elmMarkArgs[1].className = (ret != null ? '' : 'error');
          elmMarkOutput.textContent = (ret != null ? ret : 'ERROR');
          elmDiffOutput.innerHTML = elmDiffOutput.innerHTML.replace(/ /g, '<span class="sp">&sdot;</span>');
          elmMarkOutput.innerHTML = elmMarkOutput.innerHTML.replace(/ /g, '<span class="sp">&sdot;</span>');
        }, false);
      });
      elmMarkArgs.forEach(function (d) {
        d.addEventListener('input', function (evt) {
          var ret = diffmark.mark(elmMarkArgs[0].value, elmMarkArgs[1].value);
          elmMarkOutput.className = elmMarkArgs[1].className = (ret != null ? '' : 'error');
          elmMarkOutput.textContent = (ret != null ? ret : 'ERROR');
          elmDiffArgs[0].value = elmMarkArgs[0].value;
          elmDiffArgs[1].value = elmMarkOutput.textContent;
          elmDiffOutput.textContent = diffmark.diff(elmDiffArgs[0].value, elmDiffArgs[1].value);
          elmDiffOutput.innerHTML = elmDiffOutput.innerHTML.replace(/ /g, '<span class="sp">&sdot;</span>');
          elmMarkOutput.innerHTML = elmMarkOutput.innerHTML.replace(/ /g, '<span class="sp">&sdot;</span>');
        }, false);
      });
    </script>

    <pre id="dump"></pre>
    <script>
      var xhr = new XMLHttpRequest();
      xhr.open('GET', 'RantionaryDump.txt?_=' + (new Date()).getTime());
      xhr.onreadystatechange = function () {
        if (this.readyState === 4) {
          var dump = [];
          this.responseText.split('\n').forEach(function (line) {
            var words = line.split('/');
            if (words.length < 2) { return; }
            var diffs = words.map(function (item, i, arr) {
              if (i > 0) {
                return diffmark.diff(arr[0], item);
              }
              return item;
            });
            words = diffs.map(function (item, i, arr) {
              if (i > 0) {
                return diffmark.mark(arr[0], item);
              }
              return item;
            });
            dump.push('>> ' + diffs.join('/') + '\n > ' + words.join('/'));
          });
          document.getElementById('dump').textContent = dump.join('\n\n');
        }
      };
      xhr.send();
    </script>
  </body>

</html>
